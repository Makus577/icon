import React, { Component } from 'react'
import Select from 'react-select'
class AddComFer extends Component {
  constructor() {
    super()
    this.state = {
      tableData: [
        // {
        //   id: undefined,
        //   name: '',
        //   nitrogen: '',
        //   phosphorus: '',
        //   potassium: '',
        //   dosage: '',
        //   type: '',
        // }
      ]
    }
  }
  submitHandler = (e) => {
    e.preventDefault()

  }
  inputChange = (i, e) => {
    console.log(e, i)
    const { name, value } = e.target
    const {tableData} = this.state
    tableData[i][name] = value
    this.setState({
      tableData
    })
  }
  addComFer = () => {
    const { tableData } = this.state
    tableData.push({
      id: undefined,
      name: '',
      nitrogen: '',
      phosphorus: '',
      potassium: '',
      dosage: '',
      type: '',
    })
    this.setState({
      tableData
    })
  }
  removeSingFer = (i) => {
    console.log(i)
    const { tableData } = this.state
   
    this.setState({
      tableData: tableData.filter((t, index) => index !== i)
    })
  }
  typeChange = (value) => {
    this.setState({
      type: value
    })
  }
  render() {
    return <div className="add-com-fer">
      <table>
        <tbody>
          <tr>
            <td>复合肥名称</td>
            <td>氮（%）</td>
            <td>磷（%）</td>
            <td>钾（%）</td>
            <td>用量（公斤/亩）</td>
            <td>施肥类型</td>
            <td>操作</td>
          </tr>
          {
            this.state.tableData.map((t,i) => 
              <tr key={i}>
                <td>
                  <input type="text" required name='name' value={t.name} onChange={this.inputChange.bind(this, i)}/>
                </td>
                <td>
                  <input type="text" required name='nitrogen' value={t.nitrogen} onChange={this.inputChange.bind(this, i)}/>
                </td>
                <td>
                  <input type="text" required name='phosphorus' value={t.phosphorus} onChange={this.inputChange.bind(this, i)}/>
                </td>
                <td>
                  <input type="text" required name='potassium' value={t.potassium} onChange={this.inputChange.bind(this, i)}/>
                </td>
                <td>
                  <input type="text" required name='dosage' value={t.dosage} onChange={this.inputChange.bind(this, i)}/>
                </td>
                <td>
                  <Select
                    classNamePrefix='react-select'
                    placeholder=''
                    noResultsText='无'
                    onChange={this.typeChange}
                    value={this.state.type}
                    options={
                      // 底肥，种肥，追肥，叶喷，水肥一体
                      [{
                        value: 0,
                        label: '底肥'
                      },{
                        value: 1,
                        label: '种肥'
                      },{
                        value: 2,
                        label: '追肥'
                      },{
                        value: 3,
                        label: '叶喷'
                      },{
                        value: 4,
                        label: '水肥一体'
                      },]
                    }
                  ></Select>
                </td>
                <td>
                  <button type='button' className='button' onClick={this.removeSingFer.bind(this, i)}>删除</button>
                </td>
              </tr>)
          }
        </tbody>
      </table>
      
      <button type='button' className='button' onClick={this.addComFer}>+增加复合肥</button>
    </div>
  }
}

export default AddComFer